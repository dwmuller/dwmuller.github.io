<h1>Notes on WSL2 Networking</h1>
<p>WSL2 uses Hyper-V networking. There's a virtual network connected to a virtual interface
on the Windows host, and to a virtual interface on the WSL2 virtual machine, each with
their own distinct IPV4 address drawn from the 172.16.0.0/12 private IPV4 address space.
Unfortunately, these addresses change on restarts.</p>
<p>If a process running in WSL2 listens to a localhost port, then clients running on the
Windows host can also connect to that port via localhost. (I'm not sure how that's effected,
but I imagine that a better understanding of Hyper-V networking would reveal that.)</p>
<p>For example, this command in the WSL2 VM starts a simple file-serving HTTP server listening on localhost port 8000:</p>
<pre><code>python3 -m http.server
</code></pre>
<p>If you point a browser running on Windows at http://localhost:8000, you can verify that this works.</p>
<p>Connecting in the other direction, from a WSL2 client to a Windows service, is a little more complicated.
You need the virtual address of the Windows, which is provided explicitly anywhere that I know of. The
easiest, most reliable way I've seen of getting it is to get the default route from <code>ip route</code>. This Bash statement
can capture it:</p>
<pre><code>export WSL2_HOST_IP=&quot;$(/sbin/ip route | awk '/^default/ { print $3 }')&quot;
</code></pre>
<p>To test communication in that direction, run the python server on Windows, and try to connect to it from WSL2. This will likely fail, because the Windows Python installation creates explicit Block rules in the firewall to prevent connection from Public networks. The only workaround I know is to disable these rules, which is unfortunate. Similar rules often exist for Java (which is relevant if you want to run ZAP, a Java app, on Windows and proxy Linux process through it).</p>
<p>If you have problems, try temporarily disabling the firewall. If that works, then look for a specific Block rule that is applicable. While examining rules, note that the virtual network is considered by Windows to be a <em>Public</em> network! This is very surprising, and I've found no way to change that.</p>
<p>Making a port on the WSL2 VM accessible to other computers on the local network <a href="https://docs.microsoft.com/en-us/windows/wsl/compare-versions#accessing-a-wsl-2-distribution-from-your-local-area-network-lan">might be a bit more involved</a>.</p>
